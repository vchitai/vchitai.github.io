<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Big Data Platform - Apache Beam | The Barber Theme</title><meta name="description" content="Barber is a blog theme for Jekyll built by Thomas Vaeth for Samesies using HTML, Sass, and JavaScript. "><meta itemprop="name" content="Thomas Vaeth"><meta itemprop="description" content="Barber is a blog theme for Jekyll built by Thomas Vaeth for Samesies using HTML, Sass, and JavaScript. "><meta itemprop="image" content="http://barber.samesies.io/assets/images/seo.jpg"><meta property="og:url" content="http://barber.samesies.io/2018/11/02/apache-beam/"><meta property="og:type" content="website"><meta property="og:title" content="Big Data Platform - Apache Beam | The Barber Theme"><meta property="og:site_name" content="The Barber Theme"><meta property="og:description" content="Barber is a blog theme for Jekyll built by Thomas Vaeth for Samesies using HTML, Sass, and JavaScript. "><meta property="og:image" content="http://barber.samesies.io/assets/images/seo.jpg"><meta name="twitter:url" content="http://barber.samesies.io/2018/11/02/apache-beam/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Big Data Platform - Apache Beam | The Barber Theme"><meta name="twitter:site" content="The Barber Theme"><meta name="twitter:description" content="Barber is a blog theme for Jekyll built by Thomas Vaeth for Samesies using HTML, Sass, and JavaScript. "><meta name="twitter:creator" content="@thomasvaeth"><meta property="twitter:image" content="http://barber.samesies.io/assets/images/seo.jpg"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="The Barber Theme" href="/feed.xml"><link rel="canonical" href="/2018/11/02/apache-beam/"></head><body id="big-data-platform-apache-beam" class="post-layout"><header class="header"> <a class="header__title" href="http://barber.samesies.io/">The Barber Theme</a><nav><ul class="header__list"><li><a href="/">Stories</a></li><li><a href="/style-guide">Style Guide</a></li><li><span class="popup__open">Contact</span></li></ul></nav></header><main class="ğŸ’ˆ"><div class="post"><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding--double"><div class="grid-small"><h2 itemprop="name headline">Big Data Platform - Apache Beam</h2><time class="post__date" datetime="2018-11-02T00:00:00+07:00" itemprop="datePublished">2 Nov 2018</time></div></div><div class="post__content section-padding"><div class="grid"><div id="markdown" itemprop="articleBody"><h1 id="tá»•ng-quÃ¡t-vá»-apache-beam">Tá»•ng quÃ¡t vá» Apache Beam</h1><p>Apache Beam lÃ  má»™t mÃ´ hÃ¬nh thá»‘ng nháº¥t, mÃ£ nguá»“n má»Ÿ Ä‘á»ƒ cÃ i Ä‘áº·t nhá»¯ng pipeline xá»­ lÃ½ song song cho dá»¯ liá»‡u khá»‘i hay dá»¯ liá»‡u dÃ²ng. Báº¡n cÃ³ thá»ƒ xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh Ä‘á»ƒ Ä‘á»‹nh nghÄ©a pipeline nÃ³i trÃªn báº±ng nhá»¯ng cÃ´ng cá»¥ Apache Beam SDK. Pipeline sau Ä‘Ã³ cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi bá»Ÿi má»™t trong nhá»¯ng khá»‘i back-end xá»­ lÃ½ phÃ¢n tÃ¡n cÃ³ há»— trá»£ Beam nhÆ° Apache Apex, Apache Flink, Apache Spark vÃ  Google Cloud Dataflow.</p><p>Beam Ä‘áº·c biá»‡t há»¯u Ã­ch vá»›i cÃ¡ch tÃ¡c vá»¥ xá»­ lÃ½ dá»¯ liá»‡u xá»­ lÃ½ ngáº«u nhiÃªn song song - Embarassingly Parallel, trong Ä‘Ã³ váº¥n Ä‘á» cÃ³ thá»ƒ phÃ¢n rÃ£ thÃ nh nhá»¯ng khá»‘i dá»¯ liá»‡u nhá» hÆ¡n cÃ³ thá»ƒ xá»­ lÃ½ Ä‘á»™c láº­p vÃ  song song vá»›i nhau. Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng Beam Ä‘á»ƒ trÃ­ch xuáº¥t, biáº¿n Ä‘á»•i vÃ  táº£i dá»¯ liá»‡u vÃ o kho dá»¯ liá»‡u há»‡ thá»‘ng (Extract-Transform-Load ETL) vÃ  tÃ­ch há»£p dá»¯ liá»‡u gá»‘c. CÃ¡c cÃ´ng viá»‡c trÃªn giÃºp di chuyá»ƒn dá»¯ liá»‡u giá»¯a cÃ¡c phÆ°Æ¡ng tiá»‡n lÆ°u trá»¯ vÃ  nguá»“n dá»¯ liá»‡u khÃ¡c nhau, chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u vÃ o má»™t Ä‘á»‹nh dáº¡ng mong muá»‘n, vÃ  táº£i dá»¯ liá»‡u vÃ o má»™t há»‡ thá»‘ng má»›i.</p><h2 id="apache-beam-sdks">Apache Beam SDKs</h2><p>Beam hiá»‡n táº¡i Ä‘ang há»— trá»£ SDK cho cÃ¡c ngÃ´n ngá»¯ sau:</p><ul><li>Java</li><li>Python</li><li>Go Äá»“ng thá»i cÅ©ng há»— trá»£ má»™t Interface cho Scala lÃ  Scio</li></ul><h2 id="apache-beam-pipeline-runner">Apache Beam Pipeline Runner</h2><p>Nhá»¯ng Apache Beam Pipeline Runner chá»‹u trÃ¡ch nhiá»‡m dá»‹ch pipeline xá»­ lÃ½ dá»¯ liá»‡u mÃ  báº¡n Ä‘Ã£ Ä‘á»‹nh nghÄ©a vá»›i chÆ°Æ¡ng trÃ¬nh Beam thÃ nh API tÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c há»‡ thá»‘ng back-end xá»­ lÃ½ dá»¯ liá»‡u phÃ¢n tÃ¡n khÃ¡c. Khi cháº¡y má»™t chÆ°Æ¡ng trÃ¬nh Beam, báº¡n pháº£i chá»‰ ra má»™t runner tÆ°Æ¡ng thÃ­ch vá»›i há»‡ thá»‘ng back-end mÃ  báº¡n muá»‘n thá»±c thi pipeline.</p><p>Nhá»¯ng há»‡ thá»‘ng back-end xá»­ lÃ½ dá»¯ liá»‡u phÃ¢n tÃ¡n mÃ  Beam Ä‘ang há»— trá»£:</p><ul><li>Apache Apex</li><li>Apache Flink</li><li>Apache Spark</li><li>Apache Gearpump (dá»± Ã¡n Ä‘ang áº¥p á»§)</li><li>Apache Samza</li><li>Google Cloud Dataflow</li></ul><h1 id="nhá»¯ng-khÃ¡i-niá»‡m-cÆ¡-báº£n-trong-beam">Nhá»¯ng khÃ¡i niá»‡m cÆ¡ báº£n trong Beam</h1><p>Tham kháº£o: https://beam.apache.org/documentation/programming-guide/</p><p>Äá»ƒ sá»­ dá»¥ng Beam, báº¡n pháº£i xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh Driver báº±ng má»™t trong nhá»¯ng SDK cá»§a Beam. ChÆ°Æ¡ng trÃ¬nh Driver nÃ y Ä‘á»‹nh nghÄ©a táº¥t cáº£ cÃ¡c dá»¯ liá»‡u nháº­n vÃ o, cÃ¡c bÆ°á»›c biáº¿n Ä‘á»•i trung gian vÃ  dá»¯ liá»‡u xuáº¥t ra. Äá»“ng thá»i nÃ³ cÅ©ng thiáº¿t láº­p nhá»¯ng thÃ´ng sá»‘ vÃ  runner Ä‘á»ƒ thá»±c thi cho pipeline (thÃ´ng thÆ°á»ng Ä‘Æ°á»£c truyá»n báº±ng command line).</p><p>SDK Beam cÃ i Ä‘áº·t sáºµn cÃ¡c lá»›p xá»­ lÃ½ Ä‘á»ƒ Ä‘Æ¡n giáº£n hÃ³a cÆ¡ cháº¿ xá»­ lÃ½ dá»¯ liá»‡u phÃ¢n tÃ¡n cÃ³ thá»ƒ má»Ÿ rá»™ng lá»›n. CÃ¡c lá»›p xá»­ lÃ½ cá»§a Beam hoáº¡t Ä‘á»™ng nhÆ° nhau trÃªn cáº£ nguá»“n dá»¯ liá»‡u khá»‘i (batch) vÃ  dÃ²ng (stream). Khi táº¡o má»™t pipeline Beam, chÃºng ta pháº£i hiá»ƒu ráº±ng nhá»¯ng tÃ¡c vá»¥ xá»­ lÃ½ dá»¯ liá»‡u cá»§a chÃºng ta Ä‘ang hoáº¡t Ä‘á»™ng dÆ°á»›i nhá»¯ng lá»›p xá»­ lÃ½ nÃ y. NÃ³ bao gá»“m:</p><ul><li><p>Pipeline: Ä‘Ã³ng gÃ³i toÃ n bá»™ tÃ¡c vá»¥ xá»­ lÃ½ dá»¯ liá»‡u tá»« Ä‘áº§u Ä‘áº¿n cuá»‘i. Bao gá»“m cáº£ Ä‘á»c dá»¯ liá»‡u Ä‘áº§u vÃ o, biáº¿n Ä‘á»•i dá»¯ liá»‡u Ä‘Ã³ vÃ  ghi dá»¯ liá»‡u Ä‘áº§u ra. Táº¥t cáº£ chÆ°Æ¡ng trÃ¬nh Beam pháº£i táº¡o má»™t Pipeline. Khi táº¡o má»™t Pipeline, ta cÅ©ng pháº£i chá»‰ ra tÃ¹y chá»n thá»±c thi Ä‘á»ƒ cho Pipeline biáº¿t nÃªn cháº¡y á»Ÿ Ä‘Ã¢u vÃ  cháº¡y nhÆ° tháº¿ nÃ o.</p></li><li><p>PCollection: mÃ´ táº£ má»™t táº­p dá»¯ liá»‡u phÃ¢n tÃ¡n mÃ  Beam pipeline Ä‘ang thao tÃ¡c. Táº­p dá»¯ liá»‡u cÃ³ thá»ƒ cá»‘ Ä‘á»‹nh, nhÆ° tá»« nhá»¯ng nguá»“n cá»‘ Ä‘á»‹nh nhÆ° file, hay khÃ´ng cá»‘ Ä‘á»‹nh nhÆ° tá»« nhá»¯ng nguá»“n cáº­p nháº­t liÃªn tá»¥c qua subscription hay nhá»¯ng cÆ¡ cháº¿ khÃ¡c. Pipeline thÃ´ng thÆ°á»ng sáº½ táº¡o má»™t PCollection khá»Ÿi Ä‘áº§u báº±ng cÃ¡c Ä‘á»c dá»¯ liá»‡u tá»« khÃ¡c nguá»“n bÃªn ngoÃ i, nhÆ°ng ta cÅ©ng cÃ³ thá»ƒ táº¡o má»™t PCollection tá»« dá»¯ liá»‡u trong bá»™ nhá»› ngay trong chÆ°Æ¡ng trÃ¬nh. NhÆ° váº­y, cÃ¡c PCollection cÃ³ thá»ƒ lÃ  dá»¯ liá»‡u Ä‘áº§u vÃ o vÃ  Ä‘áº§u ra cho má»—i bÆ°á»›c trung gian trong pipeline.</p></li><li><p>PTransform: mÃ´ táº£ má»™t quÃ¡ trÃ¬nh xá»­ lÃ½ dá»¯ liá»‡u, hay má»™t bÆ°á»›c, trong pipeline. Má»—i PTransform nháº­n vÃ o má»™t hoáº·c nhiá»u object PCollection lÃ m input vÃ  thá»±c hiá»‡n nhá»¯ng hÃ m xá»­ lÃ½ mÃ  ta cung cáº¥p trÃªn nhá»¯ng cÃ¡c element cá»§a PCollection áº¥y vÃ  sinh ra khÃ´ng hoáº·c nhiá»u object PCollection khÃ¡c.</p></li><li><p>CÃ¡c bÆ°á»›c biáº¿n Ä‘á»•i nháº­p xuáº¥t (I/O): Beam cung cáº¥p khÃ¡ nhiá»u kiá»ƒu nháº­p xuáº¥t khÃ¡c nhau Ä‘á»ƒ Ä‘á»c ghi dá»¯ liá»‡u tá»« liá»‡u há»‡ thá»‘ng lÆ°u trá»¯ bÃªn ngoÃ i.</p></li></ul><p>Má»™t chÆ°Æ¡ng trÃ¬nh Beam thÃ´ng thÆ°á»ng sáº½ hoáº¡t Ä‘á»™ng nhÆ° sau:</p><ul><li><p>Táº¡o má»™t object Pipeline vÃ  thiáº¿t láº­p cÃ¡c thÃ´ng sá»‘ thá»±c thi cho pipeline, bao gá»“m cáº£ Pipeline Runner.</p></li><li><p>Táº¡o má»™t PCollection khá»Ÿi Ä‘áº§u cho dá»¯ liá»‡u pipeline hoáº·c sá»­ dá»¥ng IOs Ä‘á»ƒ Ä‘á»c dá»¯ liá»‡u tá»« cÃ¡c há»‡ thá»‘ng lÆ°u trá»¯ dá»¯ liá»‡u bÃªn ngoÃ i hoáº·c sá»­ dá»¥ng transform Create Ä‘á»ƒ táº¡o PCollection tá»« dá»¯ liá»‡u trong bá»™ nhá»›.</p></li><li><p>Cháº¡y PTransforms cho cÃ¡c PCollection. Transform cÃ³ thá»ƒ thay Ä‘á»•i, lá»c, nhÃ³m, phÃ¢n tÃ­ch hay xá»­ lÃ½ dá»¯ liá»‡u trong PCollection. Má»™t transform táº¡o má»™t PCollection má»›i mÃ  khÃ´ng Ä‘Æ°á»£c chá»‰nh sá»­a collection input. Má»™t pipeline thÃ´ng thÆ°á»ng cháº¡y láº§n lÆ°á»£t cÃ¡c transform cho má»—i PCollection ouput má»›i Ä‘Æ°á»£c sinh ra cho tá»›i khi hoÃ n thÃ nh quÃ¡ trÃ¬nh xá»­ lÃ½. Tuy nhiÃªn, lÆ°u Ã½ ráº±ng má»™t pipeline khÃ´ng chá»‰ lÃ  cÃ¡c transform cháº¡y tá»‘i tiáº¿p nhau theo má»™t Ä‘Æ°á»ng tháº³ng. Náº¿u xem cÃ¡c PCollection nhÆ° cÃ¡c biáº¿n cháº¡y vÃ  PTransform nhÆ° cÃ¡c hÃ m cháº¡y trÃªn cÃ¡c biáº¿n, hÃ¬nh dáº¡ng cá»§a pipeline cÃ³ thá»ƒ lÃ  má»™t Ä‘á»“ thá»‹ xá»­ lÃ½ ráº¥t phá»©c táº¡p</p></li><li><p>Sá»­ dá»¥ng IO Ä‘á»ƒ ghi cÃ¡c PCollection Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ cuá»‘i cÃ¹ng ra há»‡ thá»‘ng lÆ°u trá»¯ bÃªn ngoÃ i.</p></li><li><p>Cháº¡y pipeline sá»­ dá»¥ng Pipeline Runner Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh trÆ°á»›c</p></li></ul><p>Khi ta cháº¡y má»™t chÆ°Æ¡ng trÃ¬nh Beam, Pipeline Runner Ä‘Æ°á»£c chá»‰ Ä‘Æ°á»£c sáº½ xÃ¢y dá»±ng má»™t biá»ƒu Ä‘á»“ workflow cá»§a pipeline dá»±a trÃªn cÃ¡c PCollection mÃ  ta táº¡o ra vÃ  cÃ¡c transform mÃ  ta sá»­ dá»¥ng. Äá»“ thá»‹ Ä‘Ã³ Ä‘Æ°á»£c thá»±c thi sá»­ dá»¥ng má»™t há»‡ thá»‘ng back-end xá»­ lÃ½ phÃ¢n tÃ¡n, trá»Ÿ thÃ nh má»™t â€œjobâ€ báº¥t Ä‘á»“ng bá»™ trÃªn há»‡ thá»‘ng áº¥y.</p><h1 id="mÃ´-hÃ¬nh-thá»±c-thi-cá»§a-apache-beam">MÃ´ hÃ¬nh thá»±c thi cá»§a Apache Beam</h1><p>Tham kháº£o: https://beam.apache.org/documentation/execution-model/</p><h2 id="xá»­-lÃ½-cÃ¡c-data-element">Xá»­ lÃ½ cÃ¡c data element</h2><p>QuÃ¡ trÃ¬nh giao tiáº¿p vÃ  serialize (tuáº§n tá»± hÃ³a - tiáº¿n hÃ¬nh biáº¿n Ä‘á»•i má»™t Ä‘á»‘i tÆ°á»£ng thÃ nh má»™t Ä‘á»‹nh dáº¡ng cÃ³ thá»ƒ lÆ°u trá»¯ vÃ  di chuyá»ƒn) giá»¯a cÃ¡c element (Ä‘Æ¡n vá»‹ dá»¯ liá»‡u - Ä‘Æ¡n vá»‹ nhá» nháº¥t Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u trong Beam) giá»¯a cÃ¡c mÃ¡y tÃ­nh lÃ  má»™t trong nhá»¯ng tiáº¿n trÃ¬nh tá»‘n kÃ©m nháº¥t trong khi pipeline thá»±c thi phÃ¢n tÃ¡n. TrÃ¡nh quÃ¡ trÃ¬nh serialize nÃ y sáº½ yÃªu cáº§u pháº£i tÃ¡i xá»­ lÃ½ cÃ¡c element sau khi gáº·p lá»—i vÃ  cÃ³ thá»ƒ giá»›i háº¡n viá»‡c phÃ¢n tÃ¡n ouput tá»›i cÃ¡c mÃ¡y tÃ­nh khÃ¡c.</p><h3 id="serialize-and-giao-tiáº¿p-trong-há»‡-thá»‘ng">Serialize and giao tiáº¿p trong há»‡ thá»‘ng</h3><p>Runner cÃ³ thá»ƒ serialize cÃ¡c element giá»¯a cÃ¡c mÃ¡y Ä‘á»ƒ giao tiáº¿p vá»›i nhau vÃ  cho cÃ¡c má»¥c Ä‘Ã­ch khÃ¡c nhÆ° giá»¯ tÃ­nh bá»n vá»¯ng (persistent) cá»§a há»‡ thá»‘ng.</p><p>Má»™t runner cÃ³ thá»ƒ quyáº¿t Ä‘á»‹nh cÃ¡ch truyá»n táº£i nhá»¯ng cÃ¡c element giá»¯a cÃ¡c transform theo nhiá»u cÃ¡ch khÃ¡c nhau, nhÆ° lÃ :</p><ol><li><p>Truyá»n cÃ¡c element tá»›i má»™t worker Ä‘á»ƒ xá»­ lÃ½ nhÃ³m dá»¯ liá»‡u. Thao tÃ¡c nÃ y liÃªn quan viá»‡c serialize, nhÃ³m hay sáº¯p xáº¿p theo khÃ³a cÃ¡c element.</p></li><li><p>TÃ¡i phÃ¢n phá»‘i cÃ¡c element giá»¯a cÃ¡c worker Ä‘á»ƒ Ä‘iá»u chá»‰nh tiáº¿n trÃ¬nh song song. Thao tÃ¡c nÃ y liÃªn quan quÃ¡ trÃ¬nh serialize vÃ  giao tiáº¿p báº±ng cÃ¡c element giá»¯a cÃ¡c worker khÃ¡c nhau</p></li><li><p>Sá»­ dá»¥ng cÃ¡c element nhÆ° má»™t input cho ParDo. Viá»‡c nÃ y yÃªu cáº§u pháº£i serialize cÃ¡c element vÃ  truyá»n táº£i chÃºng tá»›i táº¥t cáº£ cÃ¡c worker thá»±c thi ParDo.</p></li><li><p>Truyá»n dá»¯ liá»‡u giá»¯a cÃ¡c transform Ä‘ang cháº¡y trÃªn cÃ¹ng má»™t worker. Cho phÃ©p Runner trÃ¡nh pháº£i serialize dá»¯ liá»‡u; thay vÃ o Ä‘Ã³, runner chá»‰ cáº§n truyá»n dá»¯ liá»‡u trong bá»™ nhá»›.</p></li></ol><p>CÃ³ vÃ i tÃ¬nh huá»‘ng khiáº¿n cho runner buá»™c pháº£i serialize vÃ  báº£o toÃ n dá»¯ liá»‡u lÃ  :</p><ul><li>Khi Ä‘ang lÃ  má»™t pháº§n cá»§a DoFn cÃ³ tráº¡ng thÃ¡i, runner pháº£i lÆ°u trá»¯ giÃ¡ trá»‹ dá»¯ liá»‡u vá»›i cÆ¡ cháº¿ quáº£n lÃ½ tráº¡ng thÃ¡i.</li><li>Khi cáº­p nháº­t káº¿t quáº£ quÃ¡ trÃ¬nh xá»­ lÃ½, runner pháº£i lÆ°u trá»¯ láº¡i cÃ¡c ouput nhÆ° lÃ  checkpoint.</li></ul><h3 id="Ä‘Ã³ng-gÃ³i-dá»¯-liá»‡u-vÃ -báº£o-toÃ n-há»‡-thá»‘ng">ÄÃ³ng gÃ³i dá»¯ liá»‡u vÃ  báº£o toÃ n há»‡ thá»‘ng</h3><p>CÃ¡c pipeline cá»§a Beam thÆ°á»ng táº­p trung vÃ o xá»­ lÃ½ váº¥n Ä‘á» â€œembarassingly parallelâ€ (Song song ngáº«u nhiÃªn - Nhá»¯ng váº¥n Ä‘á» cÃ³ kháº£ nÄƒng xá»­ lÃ½ song song mÃ  Ã­t cáº§n giao tiáº¿p giá»¯a cÃ¡c tÃ¡c vá»¥ song song). Bá»Ÿi váº­y, cÃ¡c API nháº¥n máº¡nh viá»‡c xá»­ lÃ½ dá»¯ liá»‡u song song, khiáº¿n cho nhá»¯ng thao tÃ¡c chÃ­nh xÃ¡c nhÆ° â€œgÃ¡n má»™t sá»‘ thá»© tá»± tÄƒng dáº§n cho tá»«ng cÃ¡c element trong má»™t PCollectionâ€ trá»Ÿ nÃªn khÃ³ khÄƒn. Há»‡ thá»‘ng Ä‘Æ°á»£c cá»‘ Ã½ thiáº¿t káº¿ nhÆ° váº­y vÃ¬ nhá»¯ng thuáº­t toÃ¡n nhÆ° trÃªn khÃ³ cÃ³ thá»ƒ giáº£i quyáº¿t nhá»¯ng váº¥n Ä‘á» má»Ÿ rá»™ng hÆ¡n.</p><p>Xá»­ lÃ½ táº¥t cáº£ dá»¯ liá»‡u má»™t cÃ¡ch song song cÅ©ng cÃ³ vÃ i nhÆ°á»£c Ä‘iá»ƒm. Cá»¥ thá»ƒ lÃ  nÃ³ khiáº¿n cho ta khÃ´ng thá»ƒ xá»­ lÃ½ dá»¯ liá»‡u theo khá»‘i (batch), vÃ­ dá»¥ nhÆ° khÃ´ng thá»ƒ ghi dá»¯ liá»‡u xuá»‘ng hay sao lÆ°u tiáº¿n trÃ¬nh trong lÃºc Ä‘ang xá»­ lÃ½.</p><p>Thay vÃ¬ xá»­ lÃ½ táº¥t cáº£ dá»¯ liá»‡u tuáº§n tá»±, cÃ¡c dá»¯ liá»‡u trong PCollection Ä‘Æ°á»£c xá»­ lÃ½ theo nhá»¯ng khá»‘i. Viá»‡c phÃ¢n chia cÃ¡c táº­p dá»¯ liá»‡u thÃ nh cÃ¡c khá»‘i Ä‘Æ°á»£c cÃ¡c runner thá»±c hiá»‡n má»™t cÃ¡ch tÃ¹y Ã½. Viá»‡c nÃ y cho phÃ©p runner cÃ³ thá»ƒ chá»n má»™t cÃ¡ch lÆ°u trá»¯ káº¿t quáº£ trung gian hiá»‡u quáº£ giá»¯a cÃ¡c Ä‘Æ¡n vá»‹ dá»¯ liá»‡u vÃ  cÃ³ thá»ƒ thá»±c hiá»‡n láº¡i cÃ´ng viá»‡c náº¿u cÃ³ lá»—i xáº£y ra. VÃ­ dá»¥ nhÆ° má»™t runner xá»­ lÃ½ theo stream cÃ³ thá»ƒ chá»n xá»­ lÃ½ vÃ  commit tá»«ng khá»‘i nhá» dá»¯ liá»‡u vÃ  má»™t runner xá»­ lÃ½ theo batch cÃ³ thá»ƒ xá»­ lÃ½ nhá»¯ng khá»‘i dá»¯ liá»‡u lá»›n hÆ¡n.</p><h2 id="xá»­-lÃ½-song-song-trong-vÃ -ngoÃ i-cÃ¡c-bÆ°á»›c-transform">Xá»­ lÃ½ song song trong vÃ  ngoÃ i cÃ¡c bÆ°á»›c transform</h2><h3 id="xá»­-lÃ½-dá»¯-liá»‡u-song-song-trong-má»™t-bÆ°á»›c-transform">Xá»­ lÃ½ dá»¯ liá»‡u song song trong má»™t bÆ°á»›c transform</h3><p>Khi thá»±c thi má»™t ParDo, má»™t runner cÃ³ thá»ƒ chÆ°a má»™t táº­p collection vÃ­ dá»¥ gá»“m chÃ­n Ä‘Æ¡n vá»‹ dá»¯ liá»‡u vÃ o hai khá»‘i dá»¯ liá»‡u dá»¯ liá»‡u Ä‘á»ƒ xá»­ lÃ½ nhÆ° hÃ¬nh.</p><p><img src="https://beam.apache.org/images/execution_model_bundling.svg" alt="" /></p><p>Khi ParDo trÃªn tiáº¿n hÃ nh thá»±c thi, cÃ¡c worker cÃ³ thá»ƒ xá»­ lÃ½ hai khá»‘i dá»¯ liá»‡u song song nhÆ° hÃ¬nh.</p><p><img src="https://beam.apache.org/images/execution_model_bundling_gantt.svg" alt="" /></p><p>Bá»Ÿi vÃ¬ cÃ¡c Ä‘Æ¡n vá»‹ dá»¯ liá»‡u lÃ  thÃ nh pháº§n nhá» nháº¥t khÃ´ng thá»ƒ chia nhá» hÆ¡n, sá»‘ lÆ°á»£ng tÃ¡c vá»¥ song song tá»‘i Ä‘a cho má»™t transform chÃ­nh lÃ  sá»‘ lÆ°á»£ng Ä‘Æ¡n vá»‹ dá»¯ liá»‡u trong táº­p dá»¯ liá»‡u. Táº­p dá»¯ liá»‡u Ä‘áº§u vÃ o cÃ³ chÃ­n cÃ¡c element, vÃ¬ váº­y sá»‘ lÆ°á»£ng tÃ¡c vá»¥ song song tá»‘i Ä‘a lÃ  chÃ­n.</p><p><img src="https://beam.apache.org/images/execution_model_bundling_gantt_max.svg" alt="" /></p><h3 id="xá»­-lÃ½-dá»¯-liá»‡u-song-song-giá»¯a-cÃ¡c-bÆ°á»›c-transform">Xá»­ lÃ½ dá»¯ liá»‡u song song giá»¯a cÃ¡c bÆ°á»›c transform</h3><p>CÃ¡c transform ParDo Ä‘Æ°á»£c thá»±c thi theo thá»© tá»± cÃ³ thá»ƒ Ä‘Æ°á»£c xá»­ lÃ½ song song tÃ¹y thuá»™c vÃ o cÃ¡ch runner chá»n thá»±c thi transform sá»­ dá»¥ng dá»¯ liá»‡u trÃªn cÃ¡c Ä‘Æ¡n vá»‹ dá»¯ liá»‡u Ä‘Æ°á»£c táº¡o ra bá»Ÿi transform sinh ra dá»¯ liá»‡u mÃ  khÃ´ng cáº§n Ä‘á»£i cáº£ khá»‘i. Trong hÃ¬nh minh há»a, ParDo1 vÃ  ParDo2 Ä‘Æ°á»£c thá»±c thi song song náº¿u ouput cá»§a ParDo1 cáº§n pháº£i Ä‘Æ°á»£c xá»­ lÃ½ á»Ÿ chung worker vá»›i ParDo1.</p><p><img src="https://beam.apache.org/images/execution_model_bundling_multi.svg" alt="" /></p><p>HÃ¬nh dÆ°á»›i cho chÃºng ta tháº¥y cÃ¡ch mÃ  cÃ¡c transform cÃ³ thá»ƒ thá»±c thi song song vá»›i nhau. Worker thá»© nháº¥t thá»±c thi ParDo1 trÃªn Ä‘Æ¡n vá»‹ dá»¯ liá»‡u cá»§a bundle A (khá»‘i dá»¯ liá»‡u A) táº¡o ra bundle C, vÃ  sau Ä‘Ã³ thá»±c thi ParDo2 ngay trÃªn Ä‘Æ¡n vá»‹ dá»¯ liá»‡u cá»§a bundle C.. TÆ°Æ¡ng tá»±, worker thá»© hai thá»±c thi ParDo1 trÃªn cÃ¡c Ä‘Æ¡n vá»‹ dá»¯ liá»‡u cá»§a bundle B táº¡o ra bundle D, vÃ  sau Ä‘Ã³ thá»±c thi ParDo2 ngay trÃªn Ä‘Æ¡n vá»‹ dá»¯ liá»‡u cá»§a bundle D.</p><p><img src="https://beam.apache.org/images/execution_model_bundling_multi_gantt.svg" alt="" /></p><p>Thá»±c thi cÃ¡c transform theo cÃ¡ch nÃ y cho phÃ©p runner trÃ¡nh pháº£i tÃ¡i phÃ¢n phá»‘i cÃ¡c Ä‘Æ¡n vá»‹ dá»¯ liá»‡u giá»¯a cÃ¡c worker, giÃºp tiáº¿t kiá»‡m hao phÃ­ giao tiáº¿p. Tuy nhiÃªn, cÃ¡c tÃ¡c vá»¥ song song tá»‘i Ä‘a bÃ¢y giá» phá»¥ thuá»™c vÃ o tÃ¡c vá»¥ song song tá»‘i Ä‘a cá»§a bÆ°á»›c thá»±c thi song song Ä‘áº§u tiÃªn.</p><h2 id="xá»­-lÃ½-lá»—i-giá»¯a-cÃ¡c-bÆ°á»›c-transform">Xá»­ lÃ½ lá»—i giá»¯a cÃ¡c bÆ°á»›c transform</h2><h3 id="lá»—i-trong-má»™t-bÆ°á»›c-tranform">Lá»—i trong má»™t bÆ°á»›c tranform</h3><p>Náº¿u quÃ¡ trÃ¬nh xá»­ lÃ½ cá»§a má»™t Ä‘Æ¡n vá»‹ dá»¯ liá»‡u trong bundle tháº¥t báº¡i, toÃ n bá»™ bundle sáº½ tháº¥t báº¡i. ToÃ n bá»™ quÃ¡ trÃ¬nh xá»­ lÃ½ elements trÃªn bundle Ä‘Ã³ pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n láº¡i ngay Ä‘á»ƒ trÃ¡nh toÃ n bá»™ pipeline tháº¥t báº¡i, máº·c dÃ¹ chÃºng khÃ´ng cáº§n thiáº¿t pháº£i pháº£i xá»­ lÃ½ láº¡i cÃ¹ng vá»›i bundle cÅ©.</p><p>Vá»›i vÃ­ dá»¥ nÃ y, chÃºng ta sáº½ sá»­ dá»¥ng ParDo tá»« phÃ­a trÃªn cÃ³ má»™t táº­p dá»¯ liá»‡u input gá»“m chÃ­n Ä‘Æ¡n vá»‹ dá»¯ liá»‡u vÃ  Ä‘Æ°á»£c chia thÃ nh hai bundle.</p><p>Trong hÃ¬nh dÆ°á»›i, worker thá»© nháº¥t xá»­ lÃ½ thÃ nh cÃ´ng cáº£ nÄƒm element trong bundle A. Worker thá»© hai xá»­ lÃ½ bá»‘n element trong bundle B: hai element Ä‘áº§u tiÃªn Ä‘Æ°á»£c xá»­ lÃ½ thÃ nh cÃ´ng vÃ  element thá»© ba xá»­ lÃ½ tháº¥t báº¡i, element cuá»‘i cÃ¹ng váº«n Ä‘ang chá» xá»­ lÃ½.</p><p>ChÃºng ta cÃ³ thá»ƒ tháº¥y runner sáº½ thá»±c thi láº¡i trÃªn toÃ n bá»™ dá»¯ liá»‡u trong bundle B vÃ  quÃ¡ trÃ¬nh xá»­ lÃ½ hoÃ n toÃ n thÃ nh cÃ´ng vÃ o láº§n 2. LÆ°u Ã½ ráº±ng quÃ¡ trÃ¬nh thá»±c thi láº¡i khÃ´ng cáº§n thiáº¿t pháº£i cháº¡y trÃªn cÃ¹ng worker vá»›i láº§n cháº¡y ban Ä‘áº§u.</p><p><img src="https://beam.apache.org/images/execution_model_failure_retry.svg" alt="" /></p><p>Bá»Ÿi vÃ¬ chÃºng ta gáº·p pháº£i má»™t lá»—i trong quÃ¡ trÃ¬nh xá»­ lÃ½ má»™t element trong bundle input, chÃºng ta pháº£i xá»­ lÃ½ láº¡i táº¥t cáº£ element trong bundle input. CÃ³ nghÄ©a lÃ  runner pháº£i bá» táº¥t cáº£ bundle output bá»Ÿi vÃ¬ táº¥t cáº£ káº¿t quáº£ pháº£i Ä‘Æ°á»£c tÃ­nh toÃ¡n láº¡i.</p><h3 id="coupled-failure-lá»—i-giá»¯a-cÃ¡c-bÆ°á»›c-tranform">Coupled failure: Lá»—i giá»¯a cÃ¡c bÆ°á»›c tranform</h3><p>Náº¿u cÃ³ má»™t lá»—i trong lÃºc xá»­ lÃ½ má»™t Ä‘Æ¡n vá»‹ dá»¯ liá»‡u trong ParDo2 khiáº¿n cho ParDo1 pháº£i thá»±c thi láº¡i, hai bÆ°á»›c trÃªn gá»i lÃ  co-failing.</p><p>Trong vÃ­ dá»¥ nÃ y chÃºng ta sáº½ sá»­ dá»¥ng láº¡i hai ParDo Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a á»Ÿ pháº§n trÃªn</p><p>Worker thá»© hai Ä‘Ã£ thÃ nh cÃ´ng thá»±c thi ParDo1 trÃªn táº¥t cáº£ dá»¯ liá»‡u á»Ÿ bundle B. Tuy nhiÃªn, worker tháº¥t báº¡i trong viá»‡c xá»­ lÃ½ dá»¯ liá»‡u á»Ÿ bundle D, nÃªn ParDo2 tháº¥t báº¡i. Runner buá»™c pháº£i tá»« bá» vÃ  tÃ­nh toÃ¡n láº¡i ouput cá»§a ParDo2. Bá»Ÿi vÃ¬ runner Ä‘ang thá»±c thi ParDo1 vÃ  ParDo2 cÃ¹ng nhau, bundle output tá»« ParDo1 pháº£i bá»‹ bá» Ä‘i vÃ  táº¥t cáº£ element trong bundle input pháº£i Ä‘Æ°á»£c xá»­ lÃ½ láº¡i. Hai ParDo Ä‘ang co-failing.</p><p><img src="https://beam.apache.org/images/execution_model_bundling_coupled_failure.svg" alt="" /></p><p>LÆ°u Ã½ ráº±ng bÆ°á»›c retry khÃ´ng cáº§n thiáº¿t pháº£i cÃ³ cÃ¹ng thá»i gian thá»±c hiá»‡n vá»›i láº§n Ä‘áº§u.</p><p>Táº¥t cáº£ DoFns gáº·p pháº£i coupled failures sáº½ bá»‹ ngáº¯t vÃ  bá»‹ loáº¡i bá» vÃ¬ chÃºng khÃ´ng theo lifecycle cá»§a má»™t DoFn bÃ¬nh thÆ°á»ng.</p><p>Thá»±c thi transform theo hÆ°á»›ng nÃ y cho phÃ©p runner trÃ¡nh lÆ°u trá»¯ cÃ¡c Ä‘Æ¡n vá»‹ dá»¯ liá»‡u cÃ¡c bÆ°á»›c transform, tiáº¿t kiá»‡m hao phÃ­ lÆ°u trá»¯.</p></div><ul class="post__social"><li><a href="https://www.facebook.com/sharer/sharer.php?u=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-facebook"></i></a></li><li><a href="https://twitter.com/intent/tweet?&text=Big Data Platform - Apache Beam+http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://plus.google.com/share?url=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-google-plus"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&source=Big Data Platform - Apache Beam&summary=&url=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://www.stumbleupon.com/badge/?url=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-stumbleupon"></i></a></li><li><a href="https://www.reddit.com/submit?url=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-reddit-alien"></i></a></li><li><a href="https://www.tumblr.com/share/link?url=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-tumblr"></i></a></li><li><a href="https://www.pinterest.com/pin/create/link/?description=&media=&url=http://barber.samesies.io/2018/11/02/apache-beam/" target="_blank"><i class="fa fa-pinterest"></i></a></li></ul></div></div></article></div></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get a weekly email of posts Iâ€™ve added to the site.</p><form method="POST" action="https://samesies.us17.list-manage.com/subscribe/post-json?u=66ddf555dab480e6a8606430b&amp;id=89b3ee034f&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_66ddf555dab480e6a8606430b_89b3ee034f" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__tags"><li><a class="footer__link" href="/tag/kale">Kale</a></li><li><a class="footer__link" href="/tag/moon-drinking">Moon Drinking</a></li><li><a class="footer__link" href="/tag/squid">Squid</a></li><li><a class="footer__link" href="/tag/mixtape">Mixtape</a></li><li><a class="footer__link" href="/tag/dummy-text">Dummy Text</a></li></ul><ul class="footer__social"><li><a href="https://twitter.com/thomasvaeth" target="_blank"><i class="fa fa-twitter"></i></a></li><li><a href="https://www.instagram.com/thomas.vaeth/" target="_blank"><i class="fa fa-instagram"></i></a></li><li><a href="https://www.linkedin.com/in/thomasvaeth/" target="_blank"><i class="fa fa-linkedin"></i></a></li><li><a href="https://github.com/samesies" target="_blank"><i class="fa fa-github"></i></a></li><li><a href="https://codepen.io/thomasvaeth/" target="_blank"><i class="fa fa-codepen"></i></a></li></ul></div></div></footer><section class="contact popup"><div class="popup__close"><div class="popup__exit"></div></div><div class="contact__container popup__container"><div class="contact__img"><figure class="absolute-bg" style="background-image: url(/assets/images/placeholder-28.jpg);"></figure></div><div class="contact__content"><div class="contact__mast section-padding--half"><div class="grid"><h2>Contact</h2></div></div><div class="section-padding--none"><hr class="sep"/></div><div class="contact__form section-padding--half"><div class="grid-xlarge"> <form id="form" class="form" action="https://formcarry.com/s/HkIo0nMb7" method="POST"><div class="form__subcontainer"><div> <label for="form-first-name">First Name</label> <input type="text" name="first-name" id="form-first-name" required></div><div> <label for="form-last-name">Last Name</label> <input type="text" name="last-name" id="form-last-name" required></div></div><div> <label for="form-email">E-Mail</label> <input type="email" name="email" id="form-email" required></div><div> <label for="form-message">Message</label> <textarea name="message" id="form-message" rows="3"></textarea></div><div class="form__submit"><div class="form__btn"> <input type="submit" value="Send"></div></div><p class="form__message"></p></form></div></div></div></div></section><script src="/assets/js/app.min.js"></script></body></html>
  